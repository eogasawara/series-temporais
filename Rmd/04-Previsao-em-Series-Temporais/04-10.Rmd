---
title: "Aula 04 - Slide 10"
output: html_document
---

## Objetivo
Reproduzir a figura/resultado do slide 10 da Aula 04.

## Descricao
Este documento explica o passo a passo do codigo para gerar a figura/resultado associado ao slide.

## Conexao com o PDF
Slide 10 do PDF correspondente da Aula 04.

## Referencia
Hyndman, R.J., Athanasopoulos, G. (2021). Forecasting: Principles and Practice (3rd ed.). OTexts.

```{r codigo, message=FALSE, warning=FALSE}
# Didatico: roteiro em 3 passos
# 1) Carregar dependencias/rotinas auxiliares.
# 2) Preparar dados e parametros do exemplo.
# 3) Gerar a figura/resultado esperado.
source("https://raw.githubusercontent.com/eogasawara/series-temporais/main/code/utils.R")

# Slide 04-10 — Previsão pontual vs intervalar (previsão como distribuição condicional)
# (a) Fan chart (forecast::autoplot) com intervalos
# (b) Distribuição empírica do valor em um horizonte h via simulação (paths)

set.seed(2026)

suppressPackageStartupMessages({
  library(forecast)
  library(ggplot2)
})

n_aula  <- 4
n_slide <- 10

# Série com tendência estocástica simples (para deixar intervalos bem visíveis):
# passeio aleatório + ruído
n <- 150
x <- ts(cumsum(rnorm(n, 0, 1)))

fit <- auto.arima(x)   # dentro do escopo clássico (Box-Jenkins/forecast)
h <- 24
fc <- forecast(fit, h = h, level = c(80, 95))

fa <- har_slide_file(n_aula, n_slide, "a")
fb <- har_slide_file(n_aula, n_slide, "b")
fo <- har_slide_file(n_aula, n_slide)

# (a) Previsão pontual + intervalos
pa <- autoplot(fc) +
  ggtitle("Previsão pontual e intervalar (80% e 95%)") +
  xlab("Tempo") + ylab("Valor")

har_ggsave_px(fa, pa, width_px = TSED_WIDTH, height_px = TSED_HEIGHT, dpi = TSED_DPI)

# (b) Previsão como distribuição: simular muitos futuros e olhar X_{t+h}
R <- 2000
sim_paths <- replicate(R, simulate(fit, nsim = h, future = TRUE))
x_h <- as.numeric(sim_paths[h, ])

dfb <- data.frame(xh = x_h)

pb <- ggplot(dfb, aes(x = xh)) +
  geom_histogram(bins = 40) +
  ggtitle(paste0("Distribuição condicional aprox. de X_{t+", h, "}")) +
  xlab("Valor simulado em horizonte h") + ylab("Frequência") +
  labs(caption = "Histograma de trajetórias simuladas: previsão é uma DISTRIBUIÇÃO, não só um número.")

har_ggsave_px(fb, pb, width_px = TSED_WIDTH, height_px = TSED_HEIGHT, dpi = TSED_DPI)

har_concat_png(fo, c(fa, fb))
```

