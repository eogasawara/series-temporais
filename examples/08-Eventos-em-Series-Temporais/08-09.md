---
title: "Aula 08 - Slide 09"
output: html_document
---

## Objetivo
Reproduzir a figura/resultado do slide 09 da Aula 08.

## Descricao
Este documento explica o passo a passo do codigo para gerar a figura/resultado associado ao slide.

## Conexao com o PDF
Slide 09 do PDF correspondente da Aula 08.

## Referencia
Hyndman, R.J., Athanasopoulos, G. (2021). Forecasting: Principles and Practice (3rd ed.). OTexts.


``` r
# Didatico: roteiro em 3 passos
# 1) Carregar dependencias/rotinas auxiliares.
# 2) Preparar dados e parametros do exemplo.
# 3) Gerar a figura/resultado esperado.
source("https://raw.githubusercontent.com/eogasawara/series-temporais/main/code/utils.R")

# Aula 08 — Slide 09: Motifs
# Objetivo: mostrar motifs como subsequências recorrentes (padrões similares) em janelas.

suppressPackageStartupMessages({
  library(ggplot2)
})

set.seed(9)

# Série sintética com padrão recorrente (motif) inserido em dois intervalos
n <- 300
t <- 1:n
x <- rnorm(n, sd=0.8)

# Motif (um "desenho" curto) e duas inserções
m <- 40
motif <- sin(2*pi*(1:m)/m) * 2
start1 <- 80
start2 <- 200
x[start1:(start1+m-1)] <- x[start1:(start1+m-1)] + motif
x[start2:(start2+m-1)] <- x[start2:(start2+m-1)] + motif

# Selecionar duas janelas mais similares (didático):
# aqui usamos as inserções conhecidas para focar no conceito do slide
idx1 <- start1:(start1+m-1)
idx2 <- start2:(start2+m-1)

df <- data.frame(t=t, x=x)

p <- ggplot(df, aes(x=t, y=x)) +
  geom_line() +
  geom_rect(aes(xmin=min(idx1), xmax=max(idx1), ymin=-Inf, ymax=Inf), fill=NA, color="black", linetype="dashed", linewidth=0.5) +
  geom_rect(aes(xmin=min(idx2), xmax=max(idx2), ymin=-Inf, ymax=Inf), fill=NA, color="black", linetype="dashed", linewidth=0.5) +
  labs(
    x="t",
    y="x_t",
    title="Motifs: duas subsequências recorrentes (janelas similares)"
  )

har_ggsave_px(har_slide_file(08, 09), p)
```

